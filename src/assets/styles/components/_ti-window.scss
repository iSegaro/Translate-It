@use '../base/variables' as *;
@use '../base/mixins' as *;

// TranslationWindow component styles - for Shadow DOM injection
// Increased specificity approach to avoid !important declarations

// CSS Custom Properties for component-specific overrides
:root {
  // Window-specific animation properties
  --ti-window-border-radius: #{$border-radius-lg};
  --ti-window-opacity-hidden: 0;
  --ti-window-opacity-visible: 0.9;
  --ti-window-transform-hidden: scale(0.95);
  --ti-window-transform-visible: scale(1);
  --ti-window-visibility-hidden: hidden;
  --ti-window-visibility-visible: visible;
  --ti-window-transition: opacity 0.4s cubic-bezier(0.25, 0.8, 0.25, 1),
                            transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1),
                            visibility 0.4s cubic-bezier(0.25, 0.8, 0.25, 1),
                            width 0.4s cubic-bezier(0.25, 0.8, 0.25, 1),
                            height 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);

  // Loading window properties
  --ti-loading-width: 60px;
  --ti-loading-height: 40px;
  --ti-loading-bg-light: #ffffff;
  --ti-loading-bg-dark: #333333;
  --ti-loading-border-light: rgba(0, 0, 0, 0.1);
  --ti-loading-border-dark: rgba(255, 255, 255, 0.2);

  // Window dimensions using proper SCSS->CSS conversion
  @include window-dimensions;
}

// Base window styles with CSS Grid layout
.ti-window {
  border-radius: var(--ti-window-border-radius);
  @include shadow-lg;
  display: grid;
  grid-template-rows: auto 1fr; // header auto, body flexible
  font-family: $font-family-base;
  opacity: var(--ti-window-opacity-hidden);
  transform: var(--ti-window-transform-hidden);
  transition: var(--ti-window-transition);
  visibility: var(--ti-window-visibility-hidden);
  container-type: inline-size; // Enable container queries

  // Disable transitions when dragging
  &.is-dragging {
    transition: none;
  }

  // Loading window specific styles
  &.ti-loading-window {
    width: var(--ti-loading-width);
    height: var(--ti-loading-height);
    min-width: var(--ti-loading-width);
    min-height: var(--ti-loading-height);
    max-width: var(--ti-loading-width);
    max-height: var(--ti-loading-height);
    border-radius: 20px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--ti-loading-bg-light);
    border: $border-width $border-style var(--ti-loading-border-light);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    position: fixed;

    // Loading window visibility override
    &.visible {
      opacity: var(--ti-window-opacity-visible);
      transform: var(--ti-window-transform-visible);
      visibility: var(--ti-window-visibility-visible);
    }

    // Dark theme for loading window
    &.dark {
      background: var(--ti-loading-bg-dark);
      border-color: var(--ti-loading-border-dark);

      &.visible {
        opacity: var(--ti-window-opacity-visible);
        transform: var(--ti-window-transform-visible);
        visibility: var(--ti-window-visibility-visible);
      }
    }
  }

  // Normal window - using safe CSS variable function
  &.normal-window {
    width: #{css-var('normal-window-width', $selection-window-max-width)};
    height: max-content; // Height based on content
    min-height: #{css-var('normal-window-min-height', 120px)};
    overflow: hidden; // Establish containment context
  }

  &.visible {
    opacity: var(--ti-window-opacity-visible);
    transform: var(--ti-window-transform-visible);
    visibility: var(--ti-window-visibility-visible);
  }

  // Light theme with increased specificity
  &.light {
    background-color: var(--bg-color, #ffffff);
    border: $border-width $border-style var(--border-color, #e8e8e8);
    color: var(--text-color, #2c3e50);

    // Light theme header with maximum specificity
    .ti-window-header {
      background-color: var(--header-bg-color, #f7f7f7);
      border-bottom: $border-width $border-style var(--header-border-color, #e8e8e8);
    }

    // Light theme action buttons with maximum specificity
    .ti-action-btn {
      background-color: var(--toolbar-link-hover-bg-color, #f0f0f0);
      color: var(--text-color, #555);

      &:hover {
        background-color: var(--bg-color, #e5e5e5);
      }
    }
  }

  // Dark theme with increased specificity
  &.dark {
    background-color: var(--bg-color, #2d2d2d);
    border: $border-width $border-style var(--border-color, #424242);
    color: var(--text-color, #e0e0e0);

    // Dark theme header with maximum specificity
    .ti-window-header {
      background-color: var(--header-bg-color, #333333);
      border-bottom: $border-width $border-style var(--header-border-color, #424242);
    }

    // Dark theme action buttons with maximum specificity
    .ti-action-btn {
      background-color: var(--toolbar-link-hover-bg-color, #424242);
      color: var(--text-color, #e0e0e0);

      &:hover {
        background-color: var(--border-color, #555555);
      }
    }
  }
}

// Component-specific styles with maximum specificity
// Window header with increased specificity
.ti-window .ti-window-header,
.ti-window-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: $spacing-sm $spacing-base;
  cursor: move;
  user-select: none;
  background-color: var(--header-bg-color, #f8f9fa);
  border-bottom: $border-width $border-style var(--header-border-color, #e8e8e8);
  border-radius: var(--ti-window-border-radius) var(--ti-window-border-radius) 0 0;
}

// Header actions with increased specificity
.ti-window .ti-header-actions,
.ti-header-actions {
  display: flex;
  align-items: center;
  gap: $spacing-sm;
  flex: 1;
}

// Header close section with increased specificity
.ti-window .ti-header-close,
.ti-header-close {
  display: flex;
  align-items: center;
  margin-left: auto;
}

// Action button with increased specificity
.ti-window .ti-action-btn,
.ti-action-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--ti-action-btn-size);
  height: var(--ti-action-btn-size);
  border: none;
  border-radius: var(--ti-action-btn-border-radius);
  cursor: pointer;
  background-color: transparent;
  @include transition-fast(background-color);

  &:hover {
    background-color: var(--toolbar-link-hover-bg-color, rgba(0, 0, 0, 0.1));
  }
}

// Window body with safe CSS variable usage
.ti-window .ti-window-body,
.ti-window-body {
  padding: #{css-var('window-padding', $spacing-md)};
  min-height: #{css-var('normal-window-min-height', 120px)};
  display: flex;
  flex-direction: column;
  margin-left: #{css-var('window-body-margin', 5px)};
  margin-right: #{css-var('window-body-margin', 5px)};

  // Content constraint with natural flow
  width: 100%; // Take full width of parent
  overflow-wrap: break-word; // Break long words naturally
  overflow-x: clip; // Modern way to clip overflow
  contain: layout style; // Establish containment
  box-sizing: border-box; // Include padding in width
}

// Dark theme specific overrides
.ti-window.dark .ti-window-header {
  background-color: var(--header-bg-color, #373737);
  border-bottom-color: var(--header-border-color, #4a4a4a);
}

.ti-window.dark .ti-action-btn:hover {
  background-color: var(--toolbar-link-hover-bg-color, rgba(255, 255, 255, 0.1));
}

// Light theme specific overrides
.ti-window.light .ti-window-header {
  background-color: var(--header-bg-color, #f8f9fa);
  border-bottom-color: var(--header-border-color, #e8e8e8);
}

.ti-window.light .ti-action-btn:hover {
  background-color: var(--toolbar-link-hover-bg-color, rgba(0, 0, 0, 0.05));
}